---
- set_fact: ext=bat
  when: ansible_os_family == 'Windows'

- set_fact: ext=sh
  when: ansible_os_family != 'Windows'

- name: Add Management User
  become: true
  command: "{{jboss_bxms_eap_bin_directory}}/add-user.{{ext}} {{item.user}} {{item.password}}"
  with_items: "{{users}}"

- name: Add Groups for Management User
  become: true
  lineinfile: dest=/opt/jboss-as/jboss-eap-6.4/standalone/configuration/mgmt-groups.properties regexp=^{{item.user}}= line={{item.user}}={{item.roles}}
  with_items: "{{users}}"
